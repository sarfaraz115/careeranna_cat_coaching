{"version":3,"sources":["../source/OnScrollTo.js"],"names":["OnScrollTo","node","isActive","isVisible","activate","window","addEventListener","onScrollThrottled","onMouseWheelThrottled","onMouseWheel","event","deltaY","preventDefault","onScroll","props","onScrollTo","onScrollPast","previouslyVisible","calculateIsVisible","promise","deactivate","usesValue","then","prevProps","value","console","warn","undefined","removeEventListener","triggerDistance","offset","scrollComponent","topEdge","top","bottomEdge","height","screenTopEdge","pageYOffset","screenBottomEdge","innerHeight","children","rest","Component","propTypes","isRequired","number","func","any","defaultProps"],"mappings":"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","file":"OnScrollTo.js","sourcesContent":["import React from 'react'\r\nimport PropTypes from 'prop-types'\r\nimport createRef from 'react-create-ref'\r\nimport throttle from 'lodash/throttle'\r\n\r\nimport { getOffset } from './utility/dom'\r\n\r\nexport default class OnScrollTo extends React.Component {\r\n\tstatic propTypes = {\r\n\t\tchildren: PropTypes.node.isRequired,\r\n\t\ttriggerDistance: PropTypes.number.isRequired,\r\n\t\tonScrollTo: PropTypes.func,\r\n\t\tonScrollPast: PropTypes.func,\r\n\t\t// (optional)\r\n\t\t// Is used when `onScrollXxx` doesn't return a `Promise`.\r\n\t\tvalue: PropTypes.any\r\n\t}\r\n\r\n\tstatic defaultProps = {\r\n\t\ttriggerDistance: 0\r\n\t}\r\n\r\n\tnode = createRef()\r\n\tisActive = false\r\n\tisVisible = true\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.activate()\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps) {\r\n\t\tif (this.usesValue()) {\r\n\t\t\tif (this.props.value !== prevProps.value) {\r\n\t\t\t\tif (!this.isActive) {\r\n\t\t\t\t\tthis.activate()\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.warn('[react-responsive-ui] `<OnScrollTo/>` `value` property changed while it being \"active\": that\\'s not supposed to happen')\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tcomponentWillUnmount() {\r\n\t\tthis.deactivate()\r\n\t}\r\n\r\n\tusesValue() {\r\n\t\tconst { value } = this.props\r\n\t\treturn value !== undefined\r\n\t}\r\n\r\n\tactivate = () => {\r\n\t\twindow.addEventListener('scroll', this.onScrollThrottled)\r\n\t\twindow.addEventListener('resize', this.onScrollThrottled)\r\n\t\twindow.addEventListener('mousewheel', this.onMouseWheelThrottled)\r\n\t\tthis.isActive = true\r\n\t\t// The element may be initially visible.\r\n\t\tthis.onScrollThrottled()\r\n\t}\r\n\r\n\tdeactivate() {\r\n\t\twindow.removeEventListener('scroll', this.onScrollThrottled)\r\n\t\twindow.removeEventListener('resize', this.onScrollThrottled)\r\n\t\twindow.removeEventListener('mousewheel', this.onMouseWheelThrottled)\r\n\t\tthis.isActive = false\r\n\t}\r\n\r\n\t// Prevents some hypothetical Chrome scroll bug:\r\n\t// https://stackoverflow.com/questions/47524205/random-high-content-download-time-in-chrome/47684257#47684257\r\n\tonMouseWheel = (event) => {\r\n\t\tif (event.deltaY === 1) {\r\n\t\t\tevent.preventDefault()\r\n\t\t}\r\n\t}\r\n\r\n\tonScroll = () => {\r\n\t\tconst { onScrollTo, onScrollPast } = this.props\r\n\t\tconst previouslyVisible = this.isVisible\r\n\t\tthis.isVisible = this.calculateIsVisible()\r\n\t\tif (previouslyVisible !== this.isVisible) {\r\n\t\t\tlet promise\r\n\t\t\tif (this.isVisible) {\r\n\t\t\t\tif (onScrollTo) {\r\n\t\t\t\t\tpromise = onScrollTo()\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (onScrollPast) {\r\n\t\t\t\t\tpromise = onScrollPast()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.deactivate()\r\n\t\t\tif (promise && !this.usesValue()) {\r\n\t\t\t\tpromise.then(this.activate, this.activate)\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tonMouseWheelThrottled = throttle(this.onMouseWheel, 150)\r\n\tonScrollThrottled = throttle(this.onScroll, 150)\r\n\r\n\tcalculateIsVisible() {\r\n\t\tconst { triggerDistance } = this.props\r\n\t\tconst offset = getOffset(this.scrollComponent)\r\n\t\tconst topEdge = offset.top\r\n\t\tconst bottomEdge = offset.top + offset.height\r\n\t\tconst screenTopEdge = window.pageYOffset\r\n\t\tconst screenBottomEdge = window.pageYOffset + window.innerHeight\r\n\t\treturn topEdge < screenBottomEdge + triggerDistance &&\r\n\t\t\tbottomEdge > screenTopEdge - triggerDistance\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst {\r\n\t\t\tchildren,\r\n\t\t\tonScrollTo,\r\n\t\t\tonScrollPast,\r\n\t\t\toffset,\r\n\t\t\tvalue,\r\n\t\t\t...rest\r\n\t\t} = this.props\r\n\r\n\t\treturn (\r\n\t\t\t<div {...rest} ref={this.node}>\r\n\t\t\t\t{children}\r\n\t\t\t</div>\r\n\t\t)\r\n\t}\r\n}"]}